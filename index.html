<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black 2057 Game</title>

    
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

</head>
<body>





<style>
* {
    font-family: 'VT323', monospace;
    text-transform: uppercase;

    -webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Safari */
    -khtml-user-select: none;
    /* Konqueror HTML */
    -moz-user-select: none;
    /* Old versions of Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    /* Non-prefixed version, currently
                    supported by Chrome, Edge, Opera and Firefox */
}


body {
    background:black;
    overflow-x:hidden;
    touch-action: pan-x pan-y;
    overflow:hidden;
}


button{
    background:white;
    border:0;
    font-size:40px;
    padding:10px;
    display:block;
    width:100%;
    margin:20px 0;
    text-align:center;
    cursor:pointer;
}

.flip-horizontal {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    -ms-filter: fliph;
    /*IE*/
    filter: fliph;
    /*IE*/
}

.invert { 
    -webkit-filter: invert(100%);
    filter: invert(100%);
}

.player_normal{
    background-image: url('static/normal.png');
}

.player_walking{
    background-image: url('static/walking.gif');
}


.building{
    display:block;
    background-size:contain;
    background-position:center bottom;
    background-repeat:no-repeat;
}

.btn_info{
    display:none;
    margin-left:120px;margin-top:-100px;position:absolute;background:blue;text-align:center;border-radius:100px;padding:5px 20px;font-size:50px;color:white;
}


/* responsive */

@media screen and (min-width: 480px) {
    .building{
        width:600px;
        height:500px;
    }

    .modal_wrap{
        max-width:480px;
        margin:auto;
    }
}

@media screen and (max-width: 480px) {
    .building{
        width:400px;
        height:300px;
    }

    .modal_wrap{
        max-width:80%;
        margin:auto;
    }
}

</style>


<!--
<div style="position:fixed;text-align:center;left:0;top:10px;font-size:40px;width:100%;">BLACK 2057 - v4</div>
-->

<div id="game" style="z-index:99;position:fixed;left:0;top:0;width:100%;height:100%;">


    <table border="0" style="position:fixed;left:50%;top:10px;width:200px;margin-left:-100px;font-size:20px;" cellspacing="0" border="0" class="invert">
        <tr>
            
            <td width="16.6%">
                &nbsp;
            </td>
            <td width="16.6%" align="center" bgcolor="white">
                <img src="static/bridge3.png" width="20">
            </td>
            <td width="16.6%" align="center" bgcolor="white">
                <img src="static/house_icon2.png" width="25">
            </td>
            <td width="16.6%" align="center" bgcolor="white">
                <img src="static/tree.png" width="20">
            </td>
            <td width="16.6%" align="center" bgcolor="white">
                <img src="static/factory_icon.png" width="20">
            </td>
            <td width="16.6%">
                &nbsp;
            </td>
            
            
        </tr>
        <tr>
            <td colspan="6" style="padding:0;border-spacing:0;background:black;padding:1px;">
              <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>    
                        <td width="0%" id="percent1" bgcolor="#efefef" style="height:20px;border-right:5px #00FFFF solid;">&nbsp;</td>
                        <td width="100%" id="percent2" bgcolor="#efefef">&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td id="percentaje" colspan="6" align="center" >
            </td>
        </tr>

    </table>

    <div style="overflow-x:hidden;width:100%;">



        <div id="map" class="invert" style="position:fixed;left:0;top:0;background:url('static/bg.jpg');background-position:left bottom;background-repeat:repeat-x;background-size:auto 65%;height:100%;">
        
            <table border="0" cellspacing="0" cellpadding="0" width="100%" style="height:100%;font-size:50px;">
                <tr>
                    <td width="16.6%">
                        &nbsp;
                    </td>
                    <td width="16.6%" valign="bottom" align="center">
                        <div style="background-image:url('static/bridge3b.png')" class="building " ></div>
                        <div class="btn_info" id="room1">!</div>
                    </td>
                    <td width="16.6%" valign="bottom" align="center">
                        <div style="background-image:url('static/house2b.png?')" class="building " ></div>
                        <div class="btn_info" id="room2">!</div>
                    </td>
                    <td width="16.6%" valign="bottom" align="center">
                        <div style="background-image:url('static/parkb.png')" class="building " ></div></div>
                        <div class="btn_info" id="room3">!</div>
                    </td>
                    <td width="16.6%" valign="bottom" align="center">
                        <div style="background-image:url('static/factoryb.png')" class="building " ></div></div>
                        <div class="btn_info" id="room4">!</div>
                    </td>
                    <td width="16.6%">
                        &nbsp;
                    </td>
                </tr>
            </table>

            <!--            <div class="invert" style="position:fixed;left:0;bottom:0;background:url('static/lamp.png');height:400px;width:100%;background-size:auto 80%;background-position:left bottom;background-repeat:repeat-x;">
            </div>-->

            
        </div>

        <div id="player" class="player_normal" style="margin-bottom:-2px;position:fixed;left:50%;background-size:contain;width:150px;height:207px;bottom:0;margin-left:-75px;"></div>
        



    </div>


    <div style="background:black;z-index:1;position:fixed;left:0;top:0;width:100%;height:100%;display:none;font-size:30px;overflow-y:scroll;" id="modal">
        <div class="modal_wrap">
            <div style="color:white;padding:20px 0;">
                <span id="text"></span>&#11035;
            </div>

            <div id="actions" style="display:none;">
                <button>action 1</button>
                <button>action 2</button>
                <button onclick="closeModal()">Salir</button>
            </div>
        </div>
    </div>


    <button id="btn_check" style="display:none;width:200px;position:fixed;left:50%;top:50%;margin-left:-100px;margin-top:-50px;text-align:center;" onclick="openModal()">ENTRAR</button>

</div>










<audio id="sound_ambient" loop>
    <source src="static/mp3/ambient.mp3" type="audio/mp3">
</audio>


<audio id="sound_walking" loop>
    <source src="static/mp3/walk.mp3" type="audio/mp3">
</audio>

<audio id="sound_door" >
    <source src="static/mp3/door.mp3" type="audio/mp3">
</audio>



<script src="https://code.jquery.com/jquery-3.5.1.min.js"
integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>


<script src="https://code.jquery.com/mobile/1.5.0-rc1/jquery.mobile-1.5.0-rc1.min.js"></script>



<script>
var timer_text;
var letter_index;
var screen_width = $(document).width();
var screen_height = $(document).height();
var screen_width_half = screen_width / 2;
var scroll_x = 0;//-200;
var cursor_x;
var timer_walking;
var max_width = 5000;
var percent = 25;
var max_speed = 1.5;
var speed = max_speed;
var click_seconds = 0;
var is_walking = false;
var ambient_playing = false;
var rooms = 4;
var current_room = 2;
var is_room = false;
var stage = 0;
var delay = 50;

if( document.location.href.indexOf('?test') > -1 ){
    delay = 1;
    max_speed = 5;
}


/*
if( screen_width < 500 ){
    max_width = 10000;
}
*/

/////////////////////////////////////////////////

var stages = [

    // 0
    {
        room2: {
            text: 'eres Alex padre de una familia humilde y ahora te encuentras en casa',
            actions: [
                {text:'besar mujer', response: 'te quiero mi vida ¿por cierto no se te está haciendo tarde para ir a trabajar en la fabrica?'},
                {text:'besar hija', response: 'te quiero papi'},
                {text:'salir', event: 'stage=1;closeModal()'}
            ]
        },
    },


    // 1
    {
        
        room1: {
            text: 'hoy hace un buen día, pero deberías ir a trabajar al a fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'has vuelto a casa',
            actions: [
                {text:'besar mujer', response: '¿no deberias estar trabajando?'},
                {text:'besar hija', response: '¡papi!'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'hoy hace un buen día, pero deberías ir a trabajar al a fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'has llegado a la fabrica donde mantienes las maquinas',
            actions: [
                {text:'hablar con un compañero', response: 'has oido hablar de la app con la que puedes comunicar con las personas que han muerto'},
                {text:'arreglar maquina', event: 'stage=2;', response: 'has arreglado la máquina, ya te puedes ir'},
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },


    // 2
    {
        
        room1: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'has vuelto a casa',
            actions: [
                {text:'cenar', response: 'muy rica la cena'},
                {text:'acostar a la niña', response: 'buenas noches papi'},
                {text:'instalar app', event: 'stage=3;scroll_x=0;updatePosition();current_room=1;openModal();'},
                //{text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },


    // 3
    {
        
        room1: {
            text: 'has instalado la app, el hacker te ha atacado, acabas de despertar bajo un puente, no entiendes nada y quieres volver a casa',
            actions: [
                {text:'mirar mis manos', response: 'tienes un movil y una pistola'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'miras por la ventana y ves una persona que se parece a ti, no entiendes nada',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'quieres recuperar tu vida, asi que decides planear el plan para deshacerte de esta persona y recuperar tu vida',
            actions: [
                {text:'organizar plan', response: 'mañana por la noche cuando vuelva del trabajo lo mataras aqui en el parque', event:'stage=4;'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },

    // 4
    
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías ir a la fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí, deberías ir a la fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'nada que hacer por aquí, deberías ir a la fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'acabas de encontrar la persona que ha robado tu vida, ahora va hacia el parque',
            actions: [
                {text:'salir', event: 'stage=5;closeModal()'}
            ]
        }
    },

    // 5
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'acabas de encontrar la persona',
            actions: [
                {text:'matar', response: 'has matado la persona que te ha robado tu vida ya puedes volver a casas', event:'stage=6;'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },


    // 6
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'acabas de llegar a casa pero algo no va como esperabas tu familia no te reconoce',
            actions: [
                {text:'hablar con tu mujer', response: 'no le hagas daño a mi hija por favor'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'aqui esta el cuerpo del cadaver',
            actions: [
                {text:'investigar cuerpo', response: 'parece que tiene una libreta con ideas', event:'stage=7;closeModal()'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },

    ,


    // 7
    {
        
        room1: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'mirar móvil', response: 'recibes una llamada', event:'stage=8;closeModal()'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'en la página encuentras un número de telefono',
            actions: [
                {text:'llamar', response: 'llamas y te responde la secretaria de la aplicación que instalaste'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },

    
    // 8
    {
        
        room1: {
            text: 'te llama la persona que has matado hace unos días',
            actions: [
                {text:'dejar esta guerra', response: 'te suicidas'},
                {text:'luchar contra la empresa', response: 'continuará.....'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },
];





/////////////////////////////////////////////////

function openModal(){
    is_room = true;

    $('#map').fadeOut('slow', function(){


        var current_stage = stages[stage]['room'+current_room];
        
        $('#modal').show();
        typewriteText( current_stage.text);


        var html_actions = '';

        for(var i=0; i<current_stage.actions.length; i++){
            html_actions += '<button onclick="';
            if( current_stage.actions[i].event ){
                html_actions += current_stage.actions[i].event + ';';
            }
            
            if( current_stage.actions[i].response ){
                html_actions += 'typewriteText(\'' + current_stage.actions[i].response + '\');';
            }

            html_actions += '">' + current_stage.actions[i].text + '</button>';
        }

        $('#actions').html(html_actions);

    });
    $('#sound_door')[0].play();
    $('#sound_ambient')[0].pause();
    

}

function closeModal(){
    is_room = false;
    $('#modal').hide();
    $('#map').fadeIn('slow');
    $('#sound_door')[0].play();

}

function typewriteText(text){
    letter_index = 0;
    $('#text').html('');
    $('#actions').hide();

    timer_text = setInterval(function(){
        if( letter_index == text.length ){
            clearInterval(timer_text);

            setTimeout(function(){
                $('#actions').show();

            }, (delay*3));
        }

        $('#text').append(text[letter_index]);
        letter_index++;
    }, delay);
}

function moveLeft(){


    $('#player').addClass('flip-horizontal');

    if( percent <= 0 ) return;

    scroll_x += speed;
    updatePosition();
}

function moveRight(){


    

    //if( scroll_x <= ((max_width/2)*-1) ) return;

    if( percent >= 100 ) return;

    $('#player').removeClass('flip-horizontal');



    scroll_x -= speed;



    updatePosition();
}

function updatePosition(){


    $('#player').addClass('player_walking').removeClass('player_normal');

    $('#map').css('left', scroll_x);


    

    

    percent = (scroll_x * 100) / ( (max_width-(2*parseInt(max_width/6))) *-1);// - 20;

    //if( percent < 0 ) percent *= -1;

    percent = parseInt(percent);


    //////////////////////////
    $('#percentaje').html('debug ' + percent+'% - ' +current_room);
    //////////////////////////
    
    $('#percent1').css('width', percent + '%');
    $('#percent2').css('width', (100 - percent) + '%');


    $('#btn_check').hide();
    


    if( percent > 10 && percent < 20 ){
        $('#btn_check').show();
        current_room = 1;

    }else if( percent > 35 && percent < 45 ){
        $('#btn_check').show();
        current_room = 2;

    }else if( percent > 60 && percent < 70 ){
        $('#btn_check').show();
        current_room = 3;

    }else if( percent > 80 && percent < 90 ){
        $('#btn_check').show();
        current_room = 4;

    }else{
        current_room = false;
    }


}


function playerMove(){

    if( is_room ) return;

    clearInterval(timer_walking);
    timer_walking = setInterval(function(){

        click_seconds++;

        if( click_seconds > 200 ){
            //speed = 2;
        }

        if (screen_width_half < cursor_x) {
            moveRight();
        } else {
            moveLeft();
        }

    }, 1);

    if( !is_walking ){
        is_walking = true;
        $('#sound_walking')[0].play();

    }
    
}

function playerStop(){
    clearInterval(timer_walking);

    speed = max_speed;
    click_seconds = 0;

    $('#player').removeClass('player_walking').addClass('player_normal');

    
    $('#sound_walking')[0].pause();
    is_walking = false;
}


function startGame(){



    scroll_x = ((percent*max_width) / -100  ) ;

    //scroll_x -= 20; 


    //$('#map').css('left', scroll_x);

    //////////////////////////////






    updatePosition();
    playerStop();

    $('#map').css('width', max_width );//.css('height', screen_height);
    
    
    
    

    $('#sound_ambient').prop('volume', 0.1);

    $('#game').click(function(){
        if( !ambient_playing && !is_room ){
            ambient_playing = true;
            $('#sound_ambient')[0].play();
        }
        
    })


    $('#game').mousedown(function (e) {
        cursor_x = e.pageX;
        playerMove(cursor_x);
    });

    
    $('#game').mouseup(function (e) {
        playerStop();
    }); 



    if( screen_width < 500 ){

        


        $('#game').touchstart(function(e){
            cursor_x = e.originalEvent.touches[0].pageX;
            playerMove(cursor_x);
        });

        
        $('#game').touchend(function(e){
            playerStop();

        });

    }else{
        

        $('body').keydown(function (e) {


            if (e.keyCode == 37) {
                cursor_x = 0;
                playerMove(cursor_x);
            } else if (e.keyCode == 39) {
                cursor_x = screen_width;
                playerMove(cursor_x);
            }            
            

        });

        $('body').keyup(function(e){
            playerStop();
        });

    }



}

startGame();

openModal();

</script>
    
    
</body>
</html>
