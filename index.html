<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black 2057 Game</title>

    
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

</head>
<body>





<style>
* {
    font-family: 'VT323', monospace;
    text-transform: uppercase;

    -webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Safari */
    -khtml-user-select: none;
    /* Konqueror HTML */
    -moz-user-select: none;
    /* Old versions of Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    /* Non-prefixed version, currently
                    supported by Chrome, Edge, Opera and Firefox */
}


body {
    background:black;
    overflow-x:hidden;
    touch-action: pan-x pan-y;
    overflow:hidden;
}


button{
    background:white;
    border:0;
    font-size:40px;
    padding:10px;
    display:block;
    width:100%;
    margin:20px 0;
    text-align:center;
    cursor:pointer;
}

.flip-horizontal {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    -ms-filter: fliph;
    /*IE*/
    filter: fliph;
    /*IE*/
}

.invert { 
    -webkit-filter: invert(100%);
    filter: invert(100%);
}

.player_normal{
    background-image: url('static/normal.png');
}

.player_walking{
    background-image: url('static/walking.gif');
}


.building{
    display:block;
    background-size:contain;
    background-position:center bottom;
    background-repeat:no-repeat;
}

.btn_info{
    display:none;
    margin-left:120px;margin-top:-100px;position:absolute;background:blue;text-align:center;border-radius:100px;padding:5px 20px;font-size:50px;color:white;
}


/* responsive */

@media screen and (min-width: 480px) {
    .building{
        width:600px;
        height:500px;
    }
}

@media screen and (max-width: 480px) {
    .building{
        width:400px;
        height:300px;
    }
}

</style>


<!--
<div style="position:fixed;text-align:center;left:0;top:10px;font-size:40px;width:100%;">BLACK 2057 - v4</div>
-->

<div id="game" style="z-index:99;position:fixed;left:0;top:0;width:100%;height:100%;">


    <table style="position:fixed;left:50%;top:10px;width:200px;margin-left:-100px;font-size:20px;" cellspacing="0" border="0" class="invert">
        <tr>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/bridge3.png" width="20">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/house_icon.png" width="25">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/tree.png" width="20">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/factory_icon.png" width="20">
            </td>
        </tr>
        <tr>
            <td colspan="4" style="padding:0;border-spacing:0;background:black;padding:1px;">
              <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>    
                        <td width="0%" id="percent1" bgcolor="#efefef" style="height:20px;border-right:5px #00FFFF solid;">&nbsp;</td>
                        <td width="100%" id="percent2" bgcolor="#efefef">&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <div style="overflow-x:hidden;width:100%;">

        <div id="map" class="invert" style="position:fixed;left:0;top:0;background:url('static/bg.jpg');background-position:left bottom;background-repeat:repeat-x;background-size:auto 65%;height:100%;">
        
            <table border="0" cellspacing="0" cellpadding="0" width="100%" style="text-align:center;height:100%;font-size:50px;">
                <tr>
                    <td width="20%">&nbsp;</td>
                    <td width="20%" valign="bottom">
                        <div style="background-image:url('static/bridge3b.png')" class="building " ></div>
                        <div class="btn_info" id="room1">!</div>
                    </td>
                    <td width="20%" valign="bottom">
                        <div style="background-image:url('static/house2b.png?')" class="building " ></div>
                        <div class="btn_info" id="room2">!</div>
                    </td>
                    <td width="20%" valign="bottom">
                        <div style="background-image:url('static/parkb.png')" class="building " ></div></div>
                        <div class="btn_info" id="room3">!</div>
                    </td>
                    <td width="20%" valign="bottom">
                        <div style="background-image:url('static/factoryb.png')" class="building " ></div></div>
                        <div class="btn_info" id="room4">!</div>
                    </td>
                    <td width="20%">&nbsp;</td>
                </tr>
            </table>

            <!--            <div class="invert" style="position:fixed;left:0;bottom:0;background:url('static/lamp.png');height:400px;width:100%;background-size:auto 80%;background-position:left bottom;background-repeat:repeat-x;">
            </div>-->
        </div>

        <div id="player" class="player_normal" style="margin-bottom:-2px;position:fixed;left:50%;background-size:contain;width:150px;height:207px;bottom:0;margin-left:-75px;"></div>
        



    </div>


    <div style="background:black;z-index:1;position:fixed;left:0;top:0;width:100%;height:100%;display:none;font-size:30px;overflow-y:scroll;" id="modal">
        <div style="width:480px;margin:auto;">
            <div style="color:white;padding:20px 0;">
                <span id="text"></span>&#11035;
            </div>

            <div id="actions" style="display:none;">
                <button>action 1</button>
                <button>action 2</button>
                <button onclick="closeModal()">Salir</button>
            </div>
        </div>
    </div>


    <button id="btn_check" style="display:none;width:200px;position:fixed;left:50%;top:50%;margin-left:-100px;margin-top:-50px;text-align:center;" onclick="openModal()">INVESTIGAR</button>

</div>










<audio id="sound_ambient" loop>
    <source src="static/mp3/ambient.mp3" type="audio/mp3">
</audio>


<audio id="sound_walking" loop>
    <source src="static/mp3/walk.mp3" type="audio/mp3">
</audio>

<audio id="sound_door" >
    <source src="static/mp3/door.mp3" type="audio/mp3">
</audio>



<script src="https://code.jquery.com/jquery-3.5.1.min.js"
integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>


<script src="https://code.jquery.com/mobile/1.5.0-rc1/jquery.mobile-1.5.0-rc1.min.js"></script>



<script>
var timer_text;
var letter_index;
var screen_width = $(document).width();
var screen_height = $(document).height();
var screen_width_half = screen_width / 2;
var scroll_x = 0;//-200;
var cursor_x;
var timer_walking;
var max_width = 3000;
var percent = 0;
var speed = 1.5;
var click_seconds = 0;
var is_walking = false;
var ambient_playing = false;
var rooms = 4;
var current_room = false;
var is_room = false;
var timer_check;
var stage = 0;

/////////////////////////////////////////////////

var stages = [
    {
        room1: {
            text: 'nada por aqui 1',
            actions: [
                {text:'hola', text: 'prueba'},
                {text:'salir', event: 'closeModal'}
            ]
        },
        
        room2: {
            text: 'nada por aqui 2',
            actions: [
                {text:'hola', text: 'prueba'},
                {text:'salir', event: 'closeModal'}
            ]
        },
        
        room3: {
            text: 'nada por aqui 3',
            actions: [
                {text:'hola', text: 'prueba'},
                {text:'salir', event: 'closeModal'}
            ]
        },
        
        room4: {
            text: 'nada por aqui 4',
            actions: [
                {text:'hola', text: 'prueba'},
                {text:'salir', event: 'closeModal'}
            ]
        }
    }


];





/////////////////////////////////////////////////

function openModal(){
    is_room = true;

    $('#map').fadeOut('slow', function(){


        var current_stage = stages[stage]['room'+current_room];
        
        $('#modal').show();
        typewriteText( current_stage.text);


        var html_actions = '';

        for(var i=0; i<current_stage.actions.length; i++){
            if( current_stage.actions[i].event ){
                html_actions += '<button onclick="' + current_stage.actions[i].event + '()">' + current_stage.actions[i].text + '</button>';
            }else{
                html_actions += '<button onclick="typewriteText(\'' + current_stage.actions[i].text + '\')">' + current_stage.actions[i].text + '</button>';
            }
        }

        $('#actions').html(html_actions);

    });
    $('#sound_door')[0].play();
    

}

function closeModal(){
    is_room = false;
    $('#modal').hide();
    $('#map').fadeIn('slow');
    $('#sound_door')[0].play();

}

function typewriteText(text){
    letter_index = 0;
    $('#text').html('');
    $('#actions').hide();

    timer_text = setInterval(function(){
        if( letter_index == text.length ){
            clearInterval(timer_text);

            setTimeout(function(){
                $('#actions').show();

            }, 300);
        }

        $('#text').append(text[letter_index]);
        letter_index++;
    }, 100);
}

function moveLeft(){


    $('#player').addClass('flip-horizontal');

    if( scroll_x >= 0 ) return;

    scroll_x += speed;
    updatePosition();
}

function moveRight(){

    

    if( max_width <= (scroll_x*-1) ) return;

    $('#player').removeClass('flip-horizontal');



    scroll_x -= speed;



    updatePosition();
}

function updatePosition(){


    $('#player').addClass('player_walking').removeClass('player_normal');

    $('#map').css('left', scroll_x);



    percent = (scroll_x * 100) / max_width;

    if( percent < 0 ) percent *= -1;
    
    
    
    $('#percent1').css('width', percent + '%');
    $('#percent2').css('width', (100 - percent) + '%');

}


function playerMove(){

    if( is_room ) return;

    clearInterval(timer_walking);
    timer_walking = setInterval(function(){

        click_seconds++;

        if( click_seconds > 200 ){
            //speed = 2;
        }

        if (screen_width_half < cursor_x) {
            moveRight();
        } else {
            moveLeft();
        }

    }, 1);

    if( !is_walking ){
        is_walking = true;
        $('#sound_walking')[0].play();

    }
    
}

function playerStop(){
    clearInterval(timer_walking);

    speed = 1;
    click_seconds = 0;

    $('#player').removeClass('player_walking').addClass('player_normal');

    
    $('#sound_walking')[0].pause();
    is_walking = false;
}


function startGame(){

    timer_check = setInterval(function(){
        $('#btn_check').hide();
        current_room = false;


        if( percent > 10 && percent < 20 ){
            $('#btn_check').show();
            current_room = 1;

        }else if( percent > 40 && percent < 50 ){
            $('#btn_check').show();
            current_room = 2;

        }else if( percent > 60 && percent < 70 ){
            $('#btn_check').show();
            current_room = 3;

        }else if( percent > 80 && percent < 90 ){
            $('#btn_check').show();
            current_room = 4;

        }

    }, 1000);

    updatePosition();
    playerStop();

    $('#map').css('width', (max_width + 1000) );//.css('height', screen_height);
    

    $('#sound_ambient').prop('volume', 0.1);

    $('#game').click(function(){
        if( !ambient_playing ){
            ambient_playing = true;
            $('#sound_ambient')[0].play();
        }
        
    })


    $('#game').mousedown(function (e) {
        cursor_x = e.pageX;
        playerMove(cursor_x);
    });

    
    $('#game').mouseup(function (e) {
        playerStop();
    }); 


    if( screen_width < 600 ){

        $('#game').touchstart(function(e){
            cursor_x = e.originalEvent.touches[0].pageX;
            playerMove(cursor_x);
        });

        
        $('#game').touchend(function(e){
            playerStop();

        });

    }



}

startGame();
</script>
    
    
</body>
</html>
