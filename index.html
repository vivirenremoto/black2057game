<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black 2057 - El juego</title>



    
    <link rel="prefetch" href="static/mp3/ambient.mp3" />
    <link rel="prefetch" href="static/mp3/night.mp3" />
    <!--<link rel="prefetch" href="static/mp3/door.mp3" />-->
    <link rel="prefetch" href="static/mp3/ending.mp3" />
    <link rel="prefetch" href="static/mp3/shoot.mp3" />
    <link rel="prefetch" href="static/mp3/walk.mp3" />
    <link rel="prefetch" href="static/mp3/crying.mp3" />
    <link rel="prefetch" href="static/mp3/police.mp3" />
    <link rel="prefetch" href="static/mp3/phone.mp3" />
    <!--<link rel="prefetch" href="static/mp3/select.mp3" />-->




    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">


    <meta property="og:image" content="https://vivirenremoto.github.io/black2057game/static/social.png">
    <meta property="og:image:secure_url"
        content="https://vivirenremoto.github.io/black2057game/static/social.png">
    <meta property="og:image:alt" content="Black 2057 - El juego">
    <meta property="og:image:type" content="image/png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Black 2057 - El juego">
    <meta name="twitter:image" content="https://vivirenremoto.github.io/black2057game/static/social.png">


</head>
<body>





<style>
* {
    font-family: 'VT323', monospace;
    text-transform: uppercase;

    -webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Safari */
    -khtml-user-select: none;
    /* Konqueror HTML */
    -moz-user-select: none;
    /* Old versions of Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    /* Non-prefixed version, currently
                    supported by Chrome, Edge, Opera and Firefox */
}


body {
    background:white;
    overflow-x:hidden;
    touch-action: pan-x pan-y;
    overflow:hidden;
}


button{
    border:5px white solid;
    background:white;
    border:0;
    font-size:30px;
    padding:10px 20px;
    display:block;
    width:100%;
    margin:20px 0;
    text-align:center;
    cursor:pointer;
}

.invert_button{
    border:5px white solid;
    background:black;
    color:white;
}

.flip-horizontal {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    -ms-filter: fliph;
    /*IE*/
    filter: fliph;
    /*IE*/
}

.invert { 
    -webkit-filter: invert(100%);
    filter: invert(100%);
}

.player_normal{
    background-image: url('static/normal.png');
}

.player_walking{
    background-image: url('static/walking.gif');
}


.building{
    display:block;
    background-size:contain;
    background-position:center bottom;
    background-repeat:no-repeat;
}

.btn_info{
    display:none;
    margin-left:120px;margin-top:-100px;position:absolute;background:blue;text-align:center;border-radius:100px;padding:5px 20px;font-size:50px;color:white;
}


#modal button{text-align:left;}


.building_bridge{
    background-image:url('static/bridge3.png')
}

.building_house{
    background-image:url('static/house22.png')
}

.building_park{
    background-image:url('static/park3.png')
}

.building_factory{
    background-image:url('static/factory.png')
}



.invert .building_bridge{
    background-image:url('static/bridge3b.png')
}

.invert .building_house{
    background-image:url('static/house2d.png')
}

.invert .building_park{
    background-image:url('static/parkb.png')
}

.invert .building_factory{
    background-image:url('static/factoryb.png')
}


/* responsive */

@media screen and (min-width: 800px) {
    .building{
        width:600px;
        height:500px;
    }

    .modal_wrap{
        max-width:480px;
        margin:auto;
    }
}

@media screen and (max-width: 800px) {
    .building{
        width:450px;
        height:350px;
    }

    .modal_wrap{
        max-width:85%;
        margin:auto;
    }
}

</style>




<div id="game" style="z-index:99;position:fixed;left:0;top:0;width:100%;height:100%;">


    <table id="map_nav" border="0" style="position:fixed;left:50%;top:10px;width:200px;margin-left:-100px;font-size:20px;" cellspacing="0" border="0" >
        <tr>
            <!--
            <td width="20%%">
                &nbsp;
            </td>-->
            <td width="25%" align="center" bgcolor="white">
                <img src="static/bridge_icon.png" width="20">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/house_icon2.png" width="25">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/tree_icon.png" width="20">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/factory_icon.png" width="20">
            </td>
            

            
        </tr>
        <tr>
            <td colspan="6" style="padding:0;border-spacing:0;padding:1px;">
              <table width="100%" border="0" cellspacing="0" cellpadding="0" style="position:relative;z-index:2;">
                    <tr>    
                        <td width="0%" id="percent1" bgcolor="" style="height:20px;border-right:5px red solid;">&nbsp;</td>
                        <td width="100%" id="percent2" bgcolor="">&nbsp;</td>
                    </tr>
                </table>

                <div style="width:200px;height:50px;position:relative;margin-top:-12px;border-top:5px black dotted;"></div>
            </td>
        </tr>
        <tr>
            <td id="percentaje" colspan="6" align="center" >
            </td>
        </tr>

    </table>

    <div style="overflow-x:hidden;width:100%;">


        <div id="map" style="display:none;position:fixed;left:0;top:0;background:url('static/bg2.png');background-position:left bottom;background-repeat:repeat-x;background-size:auto 65%;height:100%;">
        
            <table border="0" cellspacing="0" cellpadding="0" width="100%" style="height:100%;font-size:50px;">
                <tr>
                    <td width="25%" valign="bottom" align="center">
                        <div class="building building_bridge" ></div>
                        <div class="btn_info" id="room1">!</div>
                    </td>
                    <td width="25%" valign="bottom" align="center">
                        <div class="building building_house" ></div>
                        <div class="btn_info" id="room2">!</div>
                    </td>
                    <td width="25%" valign="bottom" align="center">
                        <div class="building building_park" ></div></div>
                        <div class="btn_info" id="room3">!</div>
                    </td>
                    <td width="25%" valign="bottom" align="center">
                        <div class="building building_factory" ></div></div>
                        <div class="btn_info" id="room4">!</div>
                    </td>
                    
                </tr>
            </table>


            
        </div>

        <div id="player" class="player_normal" style="margin-bottom:-2px;position:fixed;left:50%;background-size:contain;width:150px;height:207px;bottom:0;margin-left:-75px;"></div>
        



    </div>


    <div style="background:black;z-index:1;position:fixed;left:0;top:0;width:100%;height:100%;display:none;font-size:30px;overflow-y:scroll;" id="modal">
        <div class="modal_wrap">
            <div style="color:white;padding:20px 0;">
                <span id="text"></span><span style="font-size:20px;">&#11035;</span>
            </div>

            <div id="actions" style="display:none;">
                <button>action 1</button>
                <button>action 2</button>
                <button onclick="closeModal()">Salir</button>
            </div>
        </div>
    </div>


    <button id="btn_check" class="invert_button" style="display:none;width:200px;position:fixed;left:50%;top:50%;margin-left:-100px;margin-top:-50px;text-align:center;" onclick="openModal()">ENTRAR</button>

</div>










<audio id="sound_ambient" loop>
    <source src="static/mp3/ambient.mp3" type="audio/mp3">
</audio>


<audio id="sound_night" loop>
    <source src="static/mp3/night.mp3" type="audio/mp3">
</audio>



<audio id="sound_walking" loop>
    <source src="static/mp3/walk.mp3" type="audio/mp3">
</audio>



<audio id="sound_crying">
    <source src="static/mp3/crying.mp3" type="audio/mp3">
</audio>

<!--
<audio id="sound_select">
    <source src="static/mp3/select.mp3" type="audio/mp3">
</audio>-->

<audio id="sound_phone" loop>
    <source src="static/mp3/phone.mp3" type="audio/mp3">
</audio>

<audio id="sound_police">
    <source src="static/mp3/police.mp3" type="audio/mp3">
</audio>
<!--
<audio id="sound_door" >
    <source src="static/mp3/door.mp3" type="audio/mp3">
</audio>
-->

<audio id="sound_ending" >
    <source src="static/mp3/ending.mp3" type="audio/mp3">
</audio>

<audio id="sound_shoot" >
    <source src="static/mp3/shoot.mp3" type="audio/mp3">
</audio>



<script src="https://code.jquery.com/jquery-3.5.1.min.js"
integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>


<script src="https://code.jquery.com/mobile/1.5.0-rc1/jquery.mobile-1.5.0-rc1.min.js"></script>



<script>
var timer_text;
var letter_index;
var screen_width = $(document).width();
var screen_height = $(document).height();
var screen_width_half = screen_width / 2;
var scroll_x = 0;//-200;
var cursor_x;
var timer_walking;
var max_width = 5000;
var max_width_aux;
var room_width = max_width / 5;
var percent = 0;
var max_speed = 2;
var speed = max_speed;
var click_seconds = 0;
var is_walking = false;
var ambient_playing = false;
var rooms = 4;
var current_room = 2;
var is_room = false;
var stage = 0;
var delay = 40;
var is_debug = false;
var is_night = false;
var is_mobile = screen_width < 800;
var current_text;





var zones_rooms = [
    [10,20],
    [40,50],
    [60,70],
    [90,100]
];




if( is_mobile ){
    //max_width = screen_width * 6;


    
    max_speed = 1.5;
    speed = max_speed;

}


if( document.location.href.indexOf('?test') > -1 ){
    delay = 1;
    max_speed = 5;
    is_debug = true;
}



/////////////////////////////////////////////////

var stages = [

    // 0
    {
        room2: {
            text: 'Eres Alex, padre de una familia humilde con una mujer e hija que te quieren, ahora te encuentras en casa',
            actions: [
                {text:'besar a tu mujer', response: 'te quiero mi vida ¿por cierto no deberías estar en la fábrica trabajando?'},
                {text:'besar a tu hija', response: 'te quiero papi, que tengas un buen día'},
                {text:'salir', event: 'stage=1;closeModal()'}
            ]
        },
    },


    // 1
    {
        
        room1: {
            text: 'hoy hace un buen día, pero deberías ir a trabajar al a fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'has vuelto a casa',
            actions: [
                {text:'besar mujer', response: '¿cariño no te van a decir nada en el trabajo en la fábrica?'},
                {text:'besar hija', response: '¡papi!'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'hoy hace un buen día, pero deberías ir a trabajar a la fábrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'actualmente muchos empleos han dejado de existir, las máquinas han reemplazado a las personas, tu trabajo consiste en mantenerlas para que funcionen las 24 horas',
            actions: [
                {text:'hablar con un compañero', response: 'Tu compañero te habla de una nueva app que te permite comunicarte con las personas que han muerto', event: 'showButton(1);showButton(2)'},
                {text:'arreglar maquina', hidden: true, event: 'stage=2;', response: 'has arreglado la máquina y terminado tu jornada laboral por hoy, ya puedes volver a casa'},
                {text:'salir', hidden: true, event: 'checkWork()'}
            ]
        }
    },


    // 2
    {
        
        room1: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'has vuelto a casa',
            actions: [
                {text:'cenar', response: 'has cocinado una lasaña vegetal y la verdad es que te ha salido muy rica'},
                {text:'acostar a la niña', response: 'buenas noches papi, te quiero mucho'},
                {text:'mirar móvil', response: 'te ha escrito un amigo de la infancia, dice que ha fallecido tu primer amor en un accidente de tráfico, al que no tuviste el valor de declararte', event: 'showButton(3)'},
                {text:'ir a la cama', hidden: true, event: 'stage=3;changeRoom(1);updatePosition();current_room=1;openModal();'},
            ]
        },
        room3: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },



    


    // 3
    {
        
        room1: {
            text: 'piensas que hubiera ocurrido si hubieras dado el paso, si ella sentía algo por ti, te gustaría quitarte esa espina del corazón',
            actions: [
                {text:'continuar', event: 'stage=4;openModal()'}
            ]
        },
    },

    // 4
    {
        
        room1: {
            text: 'tu cabeza click y aunque esto te parece una tontería, piensas sobre la app que te han contado en el trabajo',
            actions: [
                {text:'instalar app', event: 'stage=5;openModal()'}
            ]
        },
    },

    // 5
    {
        
        room1: {
            text: 'Días atrás un hacker consiguió infiltrarse en el sistema, poniendo a su disposición la consciencia de millones de personas',
            actions: [
                {text:'continuar', event: 'stage=6;openModal()'}
            ]
        },
    },

    // 6
    {
        
        room1: {
            text: 'sin saber nada de esto, Abres la app, inmediatamente el hacker se conecta en tu mente y pierdes el conocimiento',
            actions: [
                {text:'continuar', event: 'stage=7;openModal();changeNight();'}
            ]
        },
    },



    


    // 7
    {
        
        room1: {
            text: 'al día siguiente despiertas debajo un puente, no recuerdas nada y solo quieres volver a casa',
            actions: [
                {text:'mirar bolsillos', response: 'tienes un movil y una pistola'},
                {text:'leer terminos de la app', response: 'al final de los términos con letra pequeña dice que la empresa puede entrar de forma remota en la mente de una persona que use la app'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'antes de llegar a casa has visto a una persona que se parece físicamente a ti, lo has seguido hasta la puerta de tu casa',
            actions: [
                
                {text:'mirar por la ventana', response: 'parece que esa persona ha ocupado tu lugar, nadie se ha dado cuenta que realmente no eres tu, estás confundido, quizás deberías ir al parque a tomar el aire...', event:'showButton(1)'},
                {text:'salir', hidden: true, event: 'stage=8;closeModal()'}
            ]
        },
        room3: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },



    // 8
    {
        
        room1: {
            text: 'nada por hacer aquí, quizás deberías ir al parque a tomar el aire...',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada por hacer aquí, quizás deberías ir al parque a tomar el aire...',
            actions: [
                
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'desesperado quieres recuperar tu vida, empiezas a trazar un plan para deshacerte de esta persona',
            actions: [
                {text:'organizar plan', response: 'mañana por la noche cuando vuelva del trabajo lo matarás en el parque', event:'stage=9;showButton(1)'},
                {text:'salir', hidden: true, event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada por hacer aquí, quizás deberías ir al parque a tomar el aire...',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },




    


    // 9
    
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías ir a la fábrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí, deberías ir a la fábrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'nada que hacer por aquí, deberías ir a la fábrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'esperas hasta la noche, parece que acaba de salir la persona que buscas, deberías seguirlo hasta el parque',
            actions: [
                {text:'salir', event: 'stage=10;changeNight();closeModal();'}
            ]
        }
    },

    // 10
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'acabas de seguir a la persona que ha robado tu vida hasta el parque',
            actions: [
                {text:'disparar arma', event:'playShoot();'},
                //{text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },


    // 11
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'acabas de llegar a casa ',
            actions: [
                {text:'hablar con tu mujer', response: 'no sé quien eres, ni lo que buscas, pero por favor no le hagas daño a mi hija', event: 'showButton(1);playCrying()'},
                {text: 'continuar', hidden:true, event: 'stage=12;openModal();'}

            ]
        },
        room3: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },



    // 12
    {
        

        room2: {
            text: 'en ese momento miras a través de un espejo tu cara y te das cuenta que no eres la persona ue pensaba que eras',
            actions: [

                {text:'salir', event: 'stage=13;closeModal();'}
            ]
        },
    },


    /////////////////////////////////////////

    // 13

    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías ir al parque a revisar el cuerpo',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí, deberías ir al parque a revisar el cuerpo',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'entre los arbustos del parque se encuentra el cuerpo de la persona que has asesinado',
            actions: [
                {text:'revisar cuerpo', event:'stage=14;openModal();'},
                //{text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí, deberías ir al parque a revisar el cuerpo',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },



    
    // 14
    {
        room3: {
            text: 'tiene una libreta con ideas, parece que a esta persona le gustaba inventar, una de las ideas es una tecnología que permite implementar recuerdos en una persona',
            actions: [
                {text:'continuar', event:'stage=15;openModal();'},
                //{text:'salir', event: 'closeModal()'}
            ]
        },
        
    },

    // 15
    {
        room3: {
            text: 'abajo de la página aparece número de télefono, crees que eso podría tener alguna relación con lo que te ha ocurrido',
            actions: [
                {text:'llamar al teléfono', event:'stage=16;openModal();'},
                //{text:'salir', event: 'closeModal()'}
            ]
        },
        
    },
    


    
    // 16
    {
        
        room3: {
            text: 'parece que te atiende la secretaria de la app que instalaste hace unos días',
            actions: [
                {text:'colgar teléfono', event:'stage=17;openModal()'},
            ]
        },
    },



    
    // 17
    {
      
      room3: {
          text: 'en este momento no sabes quien eres, solo que te han utilizado para matar a una persona inocente',
          actions: [
              {text:'continuar', event:'stage=18;openModal();'}
              //{text:'salir', event: 'closeModal()'}
          ]
      },
     
  },


    // 18
    {
      
      room3: {
          text: 'poco a poco empiezas a atar cabos, pero todavía te faltan piezas para completar el rompecabezas',
          actions: [
              {text:'continuar', event:'stage=19;openModal();setTimeout(function(){playPhone();}, 1000);'}
              //{text:'salir', event: 'closeModal()'}
          ]
      },
     
  },



    // 19
    {
        
        room3: {
            text: 'al cabo de unos días, recibes una llamada de un teléfono oculto',
            actions: [
                {text:'atender llamada', event:'stopPhone();stage=20;openModal();'},
            ]
        },
    },

    
    // 20
    {
        
        room3: {
            text: 'la voz te resulta familiar, te das cuenta que es la persona que mataste, pero no parece que sea una persona quién está detrás de la línea, sino más bien un mensaje grabado',
            actions: [
                {text:'escuchar mensaje', event: 'playEnding();'},
                {text:'saltar', hidden:true, event: 'skipEnding()'},
            ]
        },
    },

    // 21
    {
        
        room3: {
            text: 'ahora que sabes la verdad ¿qué vas a hacer?',
            actions: [
                {text:'esto no es mi guerra', response: 'decides dar un paseo por la ciudad, te paras enfrente de un escaparate y ves que tu cara aparece en los telediarios donde te acusan de asesinato', event: 'hideButton(1);showButton(2)'},
                {text:'hacer justicia', event: 'stage=24;openModal();'},
                {text:'continuar', hidden:true, event: 'stage=22;openModal();'}
            ]
        },
    },
    
    // 22
    {
        
        room3: {
            text: 'te das cuenta que una persona te ha reconocido y sales corriendo al parque',
            actions: [
                {text:'continuar', event: 'stage=23;openModal();playPolice();'},
            ]
        },
    },

    // 23
    {
            
        room3: {
            text: 'escuchas a la policia que se está acercando, al no no tener salida y al pensar que nadie te va a creer, decides suicidarte para poner fin a esta pesadilla',
            actions: [
                {text:'continuar', event: 'stage=24;openModal();'},
            ]
        },
    },


    
    // 24
    {
        
        room3: {
            text: 'continuará...',
            actions: [
                {text:'¿Repetir?', event: 'document.location.reload();'},
                {text:'ver vídeo', event: 'openMovie()'},
                {text:'compartir historia', event: 'share()'}
            ]
        },
    }

];

function openMovie(){
    window.open('https://www.youtube.com/watch?v=kKkp-Xlr8Os&ab_channel=vivirenremoto');
}

function share(){
    var share_url = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + '&tw_p=tweetbutton&url=' + document.location.href;
    window.open(share_url);
}

function modalSetBlack(){
    $('#modal').css('background', 'black');
}

function playPhone(){
    $('#sound_phone')[0].play();
}

function stopPhone(){
    $('#sound_phone')[0].pause();
}

function playPolice(){
    $('#sound_police')[0].play();
}


function playCrying(){
    $('#sound_crying')[0].play();
}



function playShoot(){
    
    $('#text').html('');

    $('#sound_shoot')[0].play();

    $('#modal').css('background', "black url('static/blood.gif') no-repeat top center");

    $('#actions').html('');



    setTimeout(function(){


        typewriteText('acabas de matar a la persona, puedes volver a casa y fingir que nada de esto ha pasado');
        
        
        $('#actions').html('<button onclick="stage=11;modalSetBlack();closeModal();">ponerte su ropa</button>');
    
        
    }, 2000)
}

function playEnding(){
    $('#sound_ending')[0].play();

    setTimeout(function(){
        showButton(1);
    }, 1000) //1:32
}

function skipEnding(){
    $('#sound_ending')[0].pause();
    stage = 21;
    openModal();
}

function hideButton(index){
    $('#modal button:eq(' + index + ')').hide();
}

function showButton(index){
    $('#modal button:eq(' + index + ')').show();
}

function changeNight(){
    if( is_night ){
        is_night = false;
        $('#map_nav').removeClass('invert');
        $('#map').removeClass('invert');
        $('body').css('background', 'white');
        $('#btn_check').addClass('invert_button');
        $('#percent1').css('border-color', 'red');

        //$('#sound_night')[0].pause();
        //$('#sound_ambient')[0].play();
        
    }else{
        is_night = true;
        $('#map_nav').addClass('invert');
        $('#map').addClass('invert');
        $('body').css('background', 'black');
        $('#btn_check').removeClass('invert_button');
        $('#percent1').css('border-color', '#00FFFF');

        //$('#sound_ambient')[0].pause();
        //$('#sound_night')[0].play();

    }
}



////////////////////////////////////////////////

function checkWork(){
    $('#actions button:last').show();
    if( stage == 2 ){
        changeNight();
        closeModal();
    }else{
        typewriteText('Todavía no has acabado tu trabajo');
    }
}

/////////////////////////////////////////////////

function openModal(){
    is_room = true;
    //$('#sound_select')[0].play();

    $('#map').fadeOut('slow', function(){


        var current_stage = stages[stage]['room'+current_room];
        

        if( $('#modal:visible').length == 0 ){

            ///////////$('#sound_door')[0].play();
            $('#sound_ambient')[0].pause();
            $('#sound_night')[0].pause();
            $('#modal').show();
        }

        typewriteText( current_stage.text);


        var html_actions = '';

        for(var i=0; i<current_stage.actions.length; i++){
            html_actions += '<button onclick=\"hideButton(' + i + ');';
            if( current_stage.actions[i].event ){
                html_actions += current_stage.actions[i].event + ';';
            }
            
            if( current_stage.actions[i].response ){
                html_actions += 'typewriteText(\'' + current_stage.actions[i].response + '\');';
            }

            html_actions += '"';

            if( current_stage.actions[i].hidden ){

                html_actions += ' style="display:none"';
            }

            
            html_actions += '>';
            
            /*
            if( !is_mobile ){
                html_actions += (i+1) + '. ';
            }
            */

            html_actions += current_stage.actions[i].text + '</button>';
        }

        $('#actions').html(html_actions);

    });




    

}

function closeModal(){
    is_room = false;
    $('#modal').hide();
    $('#map').fadeIn('slow');
    //$('#sound_select')[0].play();
    ////////$('#sound_door')[0].play();
    //$('#sound_ambient')[0].play();


    if( is_night ){
        $('#sound_night')[0].play();
    }else{
        $('#sound_ambient')[0].play();
    }

}

function typewriteText(text){


    //$('#sound_select')[0].play();

    current_text = text;

    letter_index = 0;
    $('#text').html('');
    $('#actions').hide();

    
    clearInterval(timer_text);

    timer_text = setInterval(function(){
        if( letter_index == text.length ){
            clearInterval(timer_text);

            setTimeout(function(){
                $('#actions').show();

            }, (delay*3));
        }else{
            
            $('#text').append(text[letter_index]);
        }

        letter_index++;
    }, delay);
}

function moveLeft(){


    $('#player').addClass('flip-horizontal');

    if( percent <= 0 ) return;

    scroll_x += speed;
    updatePosition();
}

function moveRight(){

    /*
    if( is_mobile ){
        if( percent >= 100 ) return;
    }else{
        if( percent >= 80 ) return;
    }
    */

    if( percent >= 100 ) return;

    
    //if( (scroll_x*-1) >= (max_width-room_width) ) return;


    //if( scroll_x <= ((max_width/2)*-1) ) return;

    //if( percent >= 100 ) return;

    $('#player').removeClass('flip-horizontal');



    scroll_x -= speed;



    updatePosition();
}

function updatePosition(){


    $('#player').addClass('player_walking').removeClass('player_normal');

    $('#map').css('left', scroll_x);
    ///////////////////////////


    

    
    percent = (scroll_x * 100) / (max_width*-1);

    

    //percent = (scroll_x * 100) / ( (max_width-(2*parseInt(max_width/6))) *-1);// - 20;

    //if( percent < 0 ) percent *= -1;

    percent = parseInt(percent);


    //////////////////////////
    if( is_debug ){
        $('#percentaje').html(percent+'% - ' +current_room);
    }
    //////////////////////////
    
    $('#percent1').css('width', percent + '%');
    $('#percent2').css('width', (100 - percent) + '%');


    $('#btn_check').hide();
    


    if( percent >= zones_rooms[0][0] && percent <= zones_rooms[0][1] ){
        $('#btn_check').show();
        current_room = 1;

    }else if( percent >= zones_rooms[1][0] && percent <= zones_rooms[1][1] ){
        $('#btn_check').show();
        current_room = 2;

    }else if( percent >= zones_rooms[2][0] && percent <= zones_rooms[2][1] ){
        $('#btn_check').show();
        current_room = 3;

    }else if( percent >= zones_rooms[3][0] && percent <= zones_rooms[3][1] ){
        $('#btn_check').show();
        current_room = 4;

    }else{
        current_room = false;
    }


}


function playerMove(){

    if( is_room ) return;

    clearInterval(timer_walking);
    timer_walking = setInterval(function(){

        click_seconds++;

        if( click_seconds > 200 ){
            //speed = 2;
        }

        if (screen_width_half < cursor_x) {
            moveRight();
        } else {
            moveLeft();
        }

    }, 1);

    if( !is_walking ){
        is_walking = true;
        $('#sound_walking')[0].play();

    }
    
}

function playerStop(){
    clearInterval(timer_walking);

    speed = max_speed;
    click_seconds = 0;

    $('#player').removeClass('player_walking').addClass('player_normal');

    
    $('#sound_walking')[0].pause();
    is_walking = false;
}


function changeRoom(room){
    


    current_room = room;

    //max_width_aux----100
    //zones_rooms[room][0]-----x

    scroll_x = ((zones_rooms[room-1][0] + ( ( zones_rooms[room-1][1] - zones_rooms[room-1][0] )/2) ) * max_width) / 100;

    scroll_x *= -1;


    


    $('#map').css('left', scroll_x);
}


function startGame(){






    //scroll_x = ((percent*max_width) / -100  ) ;

    


    //scroll_x -= 20; 


    //$('#map').css('left', scroll_x);

    //////////////////////////////









    max_width_aux = max_width;

    if( is_mobile ){
        max_width_aux += room_width;
    }else{
        max_width_aux += (room_width*2);
    }


    
    
    $('#map').css('width', max_width_aux );//.css('height', screen_height);
    $('#map table').css('width', max_width).css('margin','auto');
    
    

    changeRoom(current_room);


    updatePosition();
    playerStop();

    

    $('#sound_ambient').prop('volume', 0.1);
    //$('#sound_night').prop('volume', 0.1);

    $('#game').click(function(){
        if( !ambient_playing && !is_room ){
            ambient_playing = true;
            $('#sound_ambient')[0].play();
        }
        
    })


    $('#game').mousedown(function (e) {
        cursor_x = e.pageX;
        playerMove(cursor_x);
    });

    
    $('#game').mouseup(function (e) {
        playerStop();
    }); 



    if( is_mobile ){

        


        $('#game').touchstart(function(e){
            cursor_x = e.originalEvent.touches[0].pageX;
            playerMove(cursor_x);
        });

        
        $('#game').touchend(function(e){
            playerStop();

        });

    }
    
    

    $('body').keydown(function (e) {


        if (e.keyCode == 37) {
            cursor_x = 0;
            playerMove(cursor_x);
        } else if (e.keyCode == 39) {
            cursor_x = screen_width;
            playerMove(cursor_x);
        }
        

    });

    $('body').keyup(function(e){
        playerStop();



        if( $('#modal:visible').length == 1 ){


            if (e.keyCode == 13) { //intro
                $('#modal button:last').click();
            }
            
            /*
            else if (e.keyCode == 49) { //1
                $('#modal button:eq(0)').click();
            }else if (e.keyCode == 50) { //2
                $('#modal button:eq(1)').click();
            }else if (e.keyCode == 51) { //3
                $('#modal button:eq(2)').click();
            }else if (e.keyCode == 52) { //4
                $('#modal button:eq(3)').click();
            }
            */

        }else{

            if (e.keyCode == 13) {
                if( $('#modal:visible').length == 0 ){
                    if( $('#btn_check:visible').length == 1 ){
                        openModal();
                    }
                }
            }
        }
    


    });



    // skip
    /*
    $('#modal').click(function(){
        if( timer_text ){
            clearInterval(timer_text);
            $('#text').html(current_text);
            $('#actions').show();
        }
    });
    */
}

startGame();

openModal();

</script>
    
    
</body>
</html>
