<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black 2057 Game</title>

    
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

</head>
<body>





<style>
* {
    font-family: 'VT323', monospace;
    text-transform: uppercase;

    -webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Safari */
    -khtml-user-select: none;
    /* Konqueror HTML */
    -moz-user-select: none;
    /* Old versions of Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    /* Non-prefixed version, currently
                    supported by Chrome, Edge, Opera and Firefox */
}


body {
    background:white;
    overflow-x:hidden;
    touch-action: pan-x pan-y;
    overflow:hidden;
}


button{
    border:5px white solid;
    background:white;
    border:0;
    font-size:30px;
    padding:10px 20px;
    display:block;
    width:100%;
    margin:20px 0;
    text-align:center;
    cursor:pointer;
}

.invert_button{
    border:5px white solid;
    background:black;
    color:white;
}

.flip-horizontal {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    -ms-filter: fliph;
    /*IE*/
    filter: fliph;
    /*IE*/
}

.invert { 
    -webkit-filter: invert(100%);
    filter: invert(100%);
}

.player_normal{
    background-image: url('static/normal.png');
}

.player_walking{
    background-image: url('static/walking.gif');
}


.building{
    display:block;
    background-size:contain;
    background-position:center bottom;
    background-repeat:no-repeat;
}

.btn_info{
    display:none;
    margin-left:120px;margin-top:-100px;position:absolute;background:blue;text-align:center;border-radius:100px;padding:5px 20px;font-size:50px;color:white;
}


#modal button{text-align:left;}


.building_bridge{
    background-image:url('static/bridge3.png')
}

.building_house{
    background-image:url('static/house22.png')
}

.building_park{
    background-image:url('static/park3.png')
}

.building_factory{
    background-image:url('static/factory.png')
}



.invert .building_bridge{
    background-image:url('static/bridge3b.png')
}

.invert .building_house{
    background-image:url('static/house2d.png')
}

.invert .building_park{
    background-image:url('static/parkb.png')
}

.invert .building_factory{
    background-image:url('static/factoryb.png')
}


/* responsive */

@media screen and (min-width: 480px) {
    .building{
        width:600px;
        height:500px;
    }

    .modal_wrap{
        max-width:480px;
        margin:auto;
    }
}

@media screen and (max-width: 480px) {
    .building{
        width:450px;
        height:350px;
    }

    .modal_wrap{
        max-width:85%;
        margin:auto;
    }
}

</style>




<div id="game" style="z-index:99;position:fixed;left:0;top:0;width:100%;height:100%;">


    <table id="map_nav" border="0" style="position:fixed;left:50%;top:10px;width:200px;margin-left:-100px;font-size:20px;" cellspacing="0" border="0" >
        <tr>
            <!--
            <td width="20%%">
                &nbsp;
            </td>-->
            <td width="25%" align="center" bgcolor="white">
                <img src="static/bridge_icon.png" width="20">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/house_icon2.png" width="25">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/tree_icon.png" width="20">
            </td>
            <td width="25%" align="center" bgcolor="white">
                <img src="static/factory_icon.png" width="20">
            </td>
            

            
        </tr>
        <tr>
            <td colspan="6" style="padding:0;border-spacing:0;padding:1px;">
              <table width="100%" border="0" cellspacing="0" cellpadding="0" style="position:relative;z-index:2;">
                    <tr>    
                        <td width="0%" id="percent1" bgcolor="" style="height:20px;border-right:5px red solid;">&nbsp;</td>
                        <td width="100%" id="percent2" bgcolor="">&nbsp;</td>
                    </tr>
                </table>

                <div style="width:200px;height:50px;position:relative;margin-top:-12px;border-top:5px black dotted;"></div>
            </td>
        </tr>
        <tr>
            <td id="percentaje" colspan="6" align="center" >
            </td>
        </tr>

    </table>

    <div style="overflow-x:hidden;width:100%;">


        <div id="map" style="display:none;position:fixed;left:0;top:0;background:url('static/bg.jpg');background-position:left bottom;background-repeat:repeat-x;background-size:auto 65%;height:100%;">
        
            <table border="0" cellspacing="0" cellpadding="0" width="100%" style="height:100%;font-size:50px;">
                <tr>
                    <td width="25%" valign="bottom" align="center">
                        <div class="building building_bridge" ></div>
                        <div class="btn_info" id="room1">!</div>
                    </td>
                    <td width="25%" valign="bottom" align="center">
                        <div class="building building_house" ></div>
                        <div class="btn_info" id="room2">!</div>
                    </td>
                    <td width="25%" valign="bottom" align="center">
                        <div class="building building_park" ></div></div>
                        <div class="btn_info" id="room3">!</div>
                    </td>
                    <td width="25%" valign="bottom" align="center">
                        <div class="building building_factory" ></div></div>
                        <div class="btn_info" id="room4">!</div>
                    </td>
                    
                </tr>
            </table>


            
        </div>

        <div id="player" class="player_normal" style="margin-bottom:-2px;position:fixed;left:50%;background-size:contain;width:150px;height:207px;bottom:0;margin-left:-75px;"></div>
        



    </div>


    <div style="background:black;z-index:1;position:fixed;left:0;top:0;width:100%;height:100%;display:none;font-size:30px;overflow-y:scroll;" id="modal">
        <div class="modal_wrap">
            <div style="color:white;padding:20px 0;">
                <span id="text"></span><span style="font-size:20px;">&#11035;</span>
            </div>

            <div id="actions" style="display:none;">
                <button>action 1</button>
                <button>action 2</button>
                <button onclick="closeModal()">Salir</button>
            </div>
        </div>
    </div>


    <button id="btn_check" class="invert_button" style="display:none;width:200px;position:fixed;left:50%;top:50%;margin-left:-100px;margin-top:-50px;text-align:center;" onclick="openModal()">ENTRAR</button>

</div>










<audio id="sound_ambient" loop>
    <source src="static/mp3/ambient.mp3" type="audio/mp3">
</audio>


<audio id="sound_walking" loop>
    <source src="static/mp3/walk.mp3" type="audio/mp3">
</audio>

<audio id="sound_door" >
    <source src="static/mp3/door.mp3" type="audio/mp3">
</audio>



<script src="https://code.jquery.com/jquery-3.5.1.min.js"
integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>


<script src="https://code.jquery.com/mobile/1.5.0-rc1/jquery.mobile-1.5.0-rc1.min.js"></script>



<script>
var timer_text;
var letter_index;
var screen_width = $(document).width();
var screen_height = $(document).height();
var screen_width_half = screen_width / 2;
var scroll_x = 0;//-200;
var cursor_x;
var timer_walking;
var max_width = 5000;
var max_width_aux;
var room_width = max_width / 5;
var percent = 0;
var max_speed = 2;
var speed = max_speed;
var click_seconds = 0;
var is_walking = false;
var ambient_playing = false;
var rooms = 4;
var current_room = 2;
var is_room = false;
var stage = 0;
var delay = 40;
var is_debug = false;
var is_night = false;
var is_mobile = screen_width < 1000;
var current_text;





var zones_rooms = [
    [10,20],
    [40,50],
    [60,70],
    [90,100]
];




if( is_mobile ){
    //max_width = screen_width * 6;


    
    max_speed = 1.5;
    speed = max_speed;

}


if( document.location.href.indexOf('?test') > -1 ){
    delay = 1;
    max_speed = 5;
    is_debug = true;
}



/////////////////////////////////////////////////

var stages = [

    // 0
    {
        room2: {
            text: 'Eres Alex, padre de una familia humilde con una mujer e hija que te quieren, ahora te encuentras en casa',
            actions: [
                {text:'besar a tu mujer', response: 'te quiero mi vida ¿por cierto no deberías estar trabajando en la fábrica?'},
                {text:'besar a tu hija', response: 'te quiero papi'},
                {text:'salir', event: 'stage=1;closeModal()'}
            ]
        },
    },


    // 1
    {
        
        room1: {
            text: 'hoy hace un buen día, pero deberías ir a trabajar al a fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'has vuelto a casa',
            actions: [
                {text:'besar mujer', response: '¿cariño no te van a decir nada en el trabajo en la fábrica?'},
                {text:'besar hija', response: '¡papi!'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'hoy hace un buen día, pero deberías ir a trabajar a la fábrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'actualmente muchos empleos han desaparecido, las máquinas han reemplazado a las personas, por suerte te dedicas a mantenerlas para que funcionen las 24 horas del día',
            actions: [
                {text:'hablar con un compañero', response: 'hey Alex, acabo de descubrir una aplicación que te permite comunicarte con las personas que han muerto'},
                {text:'arreglar maquina', event: 'stage=2;changeNight();', response: 'has arreglado la máquina, ya has terminado tu jornada y te puedes ir'},
                {text:'atender llamada', response: 'te ha llamado un viejo amigo de la infancia, te cuenta que ha fallecido tu primer amor al que nunca tuviste el valor de declararte'},
                {text:'salir', event: 'checkWork()'}
            ]
        }
    },


    // 2
    {
        
        room1: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'has vuelto a casa',
            actions: [
                {text:'cenar', response: 'has cocinado una lasaña vegetal y la verdad es que me ha salido muy rica'},
                {text:'acostar a la niña', response: 'buenas noches papi, te quiero papi'},
                {text:'instalar app', event: 'stage=3;changeRoom(1);updatePosition();current_room=1;openModal();changeNight();'},
            ]
        },
        room3: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },


    // 3
    {
        
        room1: {
            text: 'has instalado la app que te ha comentado tu compañero, un hacker ha conseguido conectarse en tu cabeza y pierdes el conocimiento, al día siguiente despiertas bajo un puente, no entiendes nada y solo quieres volver a casa',
            actions: [
                {text:'leer terminos de la app', response: 'al final sale en letra pequeña que la empresa puede entrar de forma remota en la mente de una persona que use la app'},
                {text:'mirar mis bolsillos', response: 'tienes un movil y una pistola'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'miras por la ventana y ves una persona que se parece a ti, quizás deberías ir al parque a tomar el aire...',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'quieres recuperar tu vida, asi que decides planear el plan para deshacerte de esta persona y recuperar tu vida',
            actions: [
                {text:'organizar plan', response: 'mañana por la noche cuando vuelva del trabajo a casa lo mataras aqui en el parque', event:'stage=4;'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'ya es tarde, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },

    // 4
    
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías ir a la fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí, deberías ir a la fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'nada que hacer por aquí, deberías ir a la fabrica',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'acabas de encontrar la persona que ha robado tu vida, ahora va hacia el parque',
            actions: [
                {text:'salir', event: 'stage=5;closeModal()'}
            ]
        }
    },

    // 5
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'acabas de encontrar la persona',
            actions: [
                {text:'matar', response: 'has matado la persona que te ha robado tu vida ya puedes volver a casa y fingir que no ha pasado nada', event:'stage=6;changeNight();'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí, deberías ir al parque',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },


    // 6
    {
        
        room1: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'acabas de llegar a casa pero algo no va como esperabas... tu familia no te reconoce',
            actions: [
                {text:'hablar con tu mujer', response: 'no le hagas daño a mi hija por favor'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'aqui esta el cuerpo del cadaver',
            actions: [
                {text:'investigar cuerpo', response: 'parece que tiene una libreta con ideas', event:'stage=7;openModal();'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí, deberías volver a casa',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },


    
    // 7
    {
      
        room3: {
            text: 'aparece un número de teléfono',
            actions: [
                {text:'llamar', response: 'te atiente la secretaria de la app y cuelgas enseguida', event:'stage=8;'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
       
    },


    // 8
    {
        
        room1: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'mirar móvil', response: 'recibes una llamada', event:'stage=9;openModal()'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'mirar móvil', response: 'recibes una llamada', event:'stage=9;openModal()'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'en la página encuentras un número de telefono',
            actions: [
                {text:'llamar', response: 'llamas y te responde la secretaria de la aplicación que instalaste'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'mirar móvil', response: 'recibes una llamada', event:'stage=9;openModal()'},
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },

    
    // 9
    {
        
        room1: {
            text: 'te llama la persona que has matado hace unos días',
            actions: [
                {text:'dejar esta guerra', response: 'te suicidas'},
                {text:'luchar contra la empresa', response: 'continuará.....'},
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room2: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        room3: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        },
        
        room4: {
            text: 'nada que hacer por aquí',
            actions: [
                {text:'salir', event: 'closeModal()'}
            ]
        }
    },
];

function hideButton(index){
    $('#modal button:eq(' + index + ')').hide();
}

function changeNight(){
    if( is_night ){
        is_night = false;
        $('#map_nav').removeClass('invert');
        $('#map').removeClass('invert');
        $('body').css('background', 'white');
        $('#btn_check').addClass('invert_button');
        $('#percent1').css('border-color', 'red');
    }else{
        is_night = true;
        $('#map_nav').addClass('invert');
        $('#map').addClass('invert');
        $('body').css('background', 'black');
        $('#btn_check').removeClass('invert_button');
        $('#percent1').css('border-color', '#00FFFF');

    }
}



////////////////////////////////////////////////

function checkWork(){
    $('#actions button:last').show();
    if( stage == 2 ){
        closeModal();
    }else{
        typewriteText('Todavía no has acabado tu trabajo');
    }
    $('#modal')
}

/////////////////////////////////////////////////

function openModal(){
    is_room = true;

    $('#map').fadeOut('slow', function(){


        var current_stage = stages[stage]['room'+current_room];
        

        if( $('#modal:visible').length == 0 ){

            ///////////$('#sound_door')[0].play();
            $('#sound_ambient')[0].pause();
            $('#modal').show();
        }

        typewriteText( current_stage.text);


        var html_actions = '';

        for(var i=0; i<current_stage.actions.length; i++){
            html_actions += '<button onclick=\"hideButton(' + i + ');';
            if( current_stage.actions[i].event ){
                html_actions += current_stage.actions[i].event + ';';
            }
            
            if( current_stage.actions[i].response ){
                html_actions += 'typewriteText(\'' + current_stage.actions[i].response + '\');';
            }

            html_actions += '">';
            
            if( !is_mobile ){
                html_actions += (i+1) + '. ';
            }

            html_actions += current_stage.actions[i].text + '</button>';
        }

        $('#actions').html(html_actions);

    });




    

}

function closeModal(){
    is_room = false;
    $('#modal').hide();
    $('#map').fadeIn('slow');
    ////////$('#sound_door')[0].play();

}

function typewriteText(text){

    current_text = text;

    letter_index = 0;
    $('#text').html('');
    $('#actions').hide();

    
    clearInterval(timer_text);

    timer_text = setInterval(function(){
        if( letter_index == text.length ){
            clearInterval(timer_text);

            setTimeout(function(){
                $('#actions').show();

            }, (delay*3));
        }else{
            
            $('#text').append(text[letter_index]);
        }

        letter_index++;
    }, delay);
}

function moveLeft(){


    $('#player').addClass('flip-horizontal');

    if( percent <= 0 ) return;

    scroll_x += speed;
    updatePosition();
}

function moveRight(){

    /*
    if( is_mobile ){
        if( percent >= 100 ) return;
    }else{
        if( percent >= 80 ) return;
    }
    */

    if( percent >= 100 ) return;

    
    //if( (scroll_x*-1) >= (max_width-room_width) ) return;


    //if( scroll_x <= ((max_width/2)*-1) ) return;

    //if( percent >= 100 ) return;

    $('#player').removeClass('flip-horizontal');



    scroll_x -= speed;



    updatePosition();
}

function updatePosition(){


    $('#player').addClass('player_walking').removeClass('player_normal');

    $('#map').css('left', scroll_x);
    ///////////////////////////


    

    
    percent = (scroll_x * 100) / (max_width*-1);

    

    //percent = (scroll_x * 100) / ( (max_width-(2*parseInt(max_width/6))) *-1);// - 20;

    //if( percent < 0 ) percent *= -1;

    percent = parseInt(percent);


    //////////////////////////
    if( is_debug ){
        $('#percentaje').html(percent+'% - ' +current_room);
    }
    //////////////////////////
    
    $('#percent1').css('width', percent + '%');
    $('#percent2').css('width', (100 - percent) + '%');


    $('#btn_check').hide();
    


    if( percent >= zones_rooms[0][0] && percent <= zones_rooms[0][1] ){
        $('#btn_check').show();
        current_room = 1;

    }else if( percent >= zones_rooms[1][0] && percent <= zones_rooms[1][1] ){
        $('#btn_check').show();
        current_room = 2;

    }else if( percent >= zones_rooms[2][0] && percent <= zones_rooms[2][1] ){
        $('#btn_check').show();
        current_room = 3;

    }else if( percent >= zones_rooms[3][0] && percent <= zones_rooms[3][1] ){
        $('#btn_check').show();
        current_room = 4;

    }else{
        current_room = false;
    }


}


function playerMove(){

    if( is_room ) return;

    clearInterval(timer_walking);
    timer_walking = setInterval(function(){

        click_seconds++;

        if( click_seconds > 200 ){
            //speed = 2;
        }

        if (screen_width_half < cursor_x) {
            moveRight();
        } else {
            moveLeft();
        }

    }, 1);

    if( !is_walking ){
        is_walking = true;
        $('#sound_walking')[0].play();

    }
    
}

function playerStop(){
    clearInterval(timer_walking);

    speed = max_speed;
    click_seconds = 0;

    $('#player').removeClass('player_walking').addClass('player_normal');

    
    $('#sound_walking')[0].pause();
    is_walking = false;
}


function changeRoom(room){
    


    current_room = room;

    //max_width_aux----100
    //zones_rooms[room][0]-----x

    scroll_x = ((zones_rooms[room-1][0] + ( ( zones_rooms[room-1][1] - zones_rooms[room-1][0] )/2) ) * max_width) / 100;

    scroll_x *= -1;


    


    $('#map').css('left', scroll_x);
}


function startGame(){






    //scroll_x = ((percent*max_width) / -100  ) ;

    


    //scroll_x -= 20; 


    //$('#map').css('left', scroll_x);

    //////////////////////////////









    max_width_aux = max_width;

    if( is_mobile ){
        max_width_aux += room_width;
    }else{
        max_width_aux += (room_width*2);
    }


    
    
    $('#map').css('width', max_width_aux );//.css('height', screen_height);
    $('#map table').css('width', max_width).css('margin','auto');
    
    

    changeRoom(current_room);


    updatePosition();
    playerStop();

    

    $('#sound_ambient').prop('volume', 0.1);

    $('#game').click(function(){
        if( !ambient_playing && !is_room ){
            ambient_playing = true;
            $('#sound_ambient')[0].play();
        }
        
    })


    $('#game').mousedown(function (e) {
        cursor_x = e.pageX;
        playerMove(cursor_x);
    });

    
    $('#game').mouseup(function (e) {
        playerStop();
    }); 



    if( is_mobile ){

        


        $('#game').touchstart(function(e){
            cursor_x = e.originalEvent.touches[0].pageX;
            playerMove(cursor_x);
        });

        
        $('#game').touchend(function(e){
            playerStop();

        });

    }
    
    

    $('body').keydown(function (e) {


        if (e.keyCode == 37) {
            cursor_x = 0;
            playerMove(cursor_x);
        } else if (e.keyCode == 39) {
            cursor_x = screen_width;
            playerMove(cursor_x);
        }
        

    });

    $('body').keyup(function(e){
        playerStop();



        if( $('#modal:visible').length == 1 ){


            if (e.keyCode == 13) { //intro
                $('#modal button:last').click();
            }else if (e.keyCode == 49) { //1
                $('#modal button:eq(0)').click();
            }else if (e.keyCode == 50) { //2
                $('#modal button:eq(1)').click();
            }else if (e.keyCode == 51) { //3
                $('#modal button:eq(2)').click();
            }

        }else{

            if (e.keyCode == 13) {
                if( $('#modal:visible').length == 0 ){
                    if( $('#btn_check:visible').length == 1 ){
                        openModal();
                    }
                }
            }
        }
    


    });



    // skip
    /*
    $('#modal').click(function(){
        if( timer_text ){
            clearInterval(timer_text);
            $('#text').html(current_text);
            $('#actions').show();
        }
    });
    */
}

startGame();

openModal();

</script>
    
    
</body>
</html>
